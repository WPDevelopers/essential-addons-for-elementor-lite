!function(e){e.fn.eaelZoomLense=function(t){let o=e.extend({lensWidth:100,lensHeight:100,borderRadius:"50%",lensBorder:"1px solid #aaa",resultBorder:"1px solid #aaa",gap:10,autoResize:!1,minLensSize:40,maxLensSize:300,step:10,zoomId:t.zoomId?"zoom_"+t.zoomId:"zoom"},t);return e(this).on("mouseenter touchstart mousemove touchmove",function(t){let i=e(this),n=o.zoomId;if(e(".eael-lens-"+n).length||e(".eael-result-"+n).length)return;let l=o.lensWidth,a=o.lensHeight,s=e("<div>",{class:"eael-lens-"+n,css:{position:"absolute",pointerEvents:"none",borderRadius:o.borderRadius,border:o.lensBorder,backgroundColor:"rgba(255,255,255,0.3)",zIndex:999}}).appendTo("body"),r=e("<div>",{class:"eael-result-"+n,css:{position:"absolute",border:o.resultBorder,backgroundRepeat:"no-repeat",zIndex:998}}).appendTo("body"),h=i.offset();function p(){let t=i.outerWidth(),n=i.outerHeight(),l=t,a=n,s=o.gap,r=e(window).width(),p=e(window).height(),d=e(window).scrollLeft(),f=e(window).scrollTop(),u=r-(h.left-d+t),c=h.left-d,g=p-(h.top-f+n),m=h.top-f,$={top:h.top,left:h.left},b=l,v=a;if(u>=l+s)$.left=h.left+t+s,$.top=h.top;else if(c>=l+s)$.left=h.left-l-s,$.top=h.top;else if(g>=a+s)$.left=h.left,$.top=h.top+n+s;else if(m>=a+s)$.left=h.left,$.top=h.top-a-s;else{let x=[{space:u,direction:"right",availableWidth:u,availableHeight:p},{space:c,direction:"left",availableWidth:c,availableHeight:p},{space:g,direction:"bottom",availableWidth:r,availableHeight:g},{space:m,direction:"top",availableWidth:r,availableHeight:m}];x.sort((e,t)=>t.space-e.space);let w=x[0],z=function e(t,o){let i=l/a,n=Math.min(l,t-s-20),r=Math.min(a,o-s-20);return n/i>r?n=r*i:r=n/i,(n<150||r<150)&&(i>=1?(n=150,r=150/i):(r=150,n=150*i)),{width:n,height:r}}(w.availableWidth,w.availableHeight);switch(b=z.width,v=z.height,w.direction){case"right":$.left=h.left+t+s,$.top=h.top;break;case"left":$.left=h.left-b-s,$.top=h.top;break;case"bottom":$.left=h.left,$.top=h.top+n+s;break;case"top":$.left=h.left,$.top=h.top-v-s}$.left=Math.max(d+10,Math.min($.left,d+r-b-10)),$.top=Math.max(f+10,Math.min($.top,f+p-v-10))}return{position:$,width:b,height:v,scaleX:b/l,scaleY:v/a}}let d=p();function f(e){let t=e.originalEvent.touches?e.originalEvent.touches[0]:e,o=t.pageX,n=t.pageY,h=i.offset(),p=o-l/2,d=n-a/2,f=h.left+i.outerWidth()-l,u=h.top+i.outerHeight()-a;p=Math.max(h.left,Math.min(p,f)),d=Math.max(h.top,Math.min(d,u)),s.css({width:l,height:a,top:d,left:p,display:"block"});let c=r.data("currentConfig")||{width:r.width(),height:r.height()},g=c.width/l,m=c.height/a;r.css({display:"block",backgroundPosition:`-${(p-h.left)*g}px -${(d-h.top)*m}px`})}r.css({width:d.width,height:d.height,top:d.position.top,left:d.position.left,backgroundImage:`url(${i.attr("src")})`,backgroundSize:`${i.outerWidth()*(d.width/l)}px ${i.outerHeight()*(d.height/a)}px`}),r.data("currentConfig",d),o.autoResize&&e(window).on("wheel."+n,function(e){if(!s.is(":visible"))return;e.preventDefault();let t=e.originalEvent.deltaY,n=t>0?1:-1,h=Math.max(o.minLensSize,Math.min(o.maxLensSize,l-n*o.step)),p=Math.max(o.minLensSize,Math.min(o.maxLensSize,a-n*o.step)),d=(l-h)/2,f=(a-p)/2;l=h,a=p;let u=s.offset();s.css({width:l,height:a,top:u.top+f,left:u.left+d});let c=r.data("currentConfig")||{width:r.width(),height:r.height()},g=c.width/l,m=c.height/a,$=i.offset();r.css({backgroundSize:`${i.outerWidth()*g}px ${i.outerHeight()*m}px`,backgroundPosition:`-${(s.offset().left-$.left)*g}px -${(s.offset().top-$.top)*m}px`})}),e(document).on("mousemove."+n+" touchmove."+n,f),e(window).on("scroll."+n+" resize."+n,function e(){let t=p();r.css({width:t.width,height:t.height,top:t.position.top,left:t.position.left,backgroundSize:`${i.outerWidth()*(t.width/l)}px ${i.outerHeight()*(t.height/a)}px`}),r.data("currentConfig",t)}),i.on("mouseleave."+n+" touchend."+n,function(){s.remove(),r.remove(),e(document).off("mousemove."+n+" touchmove."+n),e(window).off("wheel."+n+" scroll."+n+" resize."+n),i.off("mouseleave."+n+" touchend."+n)}),f(t)}),this},e.fn.eaelMagnify=function(t){let o=e.extend({lensSize:200,zoom:2,lensBorder:"2px solid #fff"},t);return this.each(function(){let t=e(this),i=null,n=o.zoom,l=!1;function a(){if(l)return;l=!0;let a=t[0].naturalWidth,s=t[0].naturalHeight;function r(e){if(!i)return;let o=t.offset(),l=t.width(),r=t.height(),h=e.pageX-o.left,p=e.pageY-o.top;if(h<0||p<0||h>l||p>r){i.css("opacity",0);return}let d=a*n,f=s*n,u=h/l*a*n-i.width()/2,c=p/r*s*n-i.height()/2;i.css({left:`${e.pageX-i.width()/2}px`,top:`${e.pageY-i.height()/2}px`,backgroundPosition:`-${u}px -${c}px`,backgroundSize:`${d}px ${f}px`,opacity:1})}t.on("mouseenter touchstart mousemove touchmove",function(){i||(i=e('<div class="eael-magnify-lens"></div>').css({width:o.lensSize,height:o.lensSize,border:o.lensBorder,backgroundImage:`url(${t.attr("src")})`,backgroundRepeat:"no-repeat",pointerEvents:"none",opacity:0,boxShadow:"0 5px 10px rgba(0, 0, 0, 0.2)",borderRadius:"50%",transition:"opacity 0.2s",position:"absolute",zIndex:9999}),e("body").append(i))}),t.on("mousemove touchmove",r),t.on("mouseleave touchend",function(){i&&(i.css("opacity",0),setTimeout(()=>{i?.remove(),i=null},200))}),t.on("wheel",function(e){if(!i)return;e.preventDefault();let t=e.originalEvent.deltaY||e.originalEvent.wheelDelta;n=t>0?Math.max(1,n-.1):Math.min(5,n+.1),r(e)})}t[0].complete&&t[0].naturalWidth?a():t.one("load",a)})}}(jQuery);