!function(e){var a={};function t(n){if(a[n])return a[n].exports;var l=a[n]={i:n,l:!1,exports:{}};return e[n].call(l.exports,l,l.exports,t),l.l=!0,l.exports}t.m=e,t.c=a,t.d=function(e,a,n){t.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,a){if(1&a&&(e=t(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var l in e)t.d(n,l,function(a){return e[a]}.bind(null,l));return n},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="",t(t.s=23)}({23:function(e,a){function t(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(){!function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.panel=null,this.model=null,this.view=null,this.table=null,this.timeout=null,this.activeCell=null,this.dragStartX=null,this.dragStartWidth=null,this.dragEl=null,this.dragging=!1,ea.hooks.addFilter("advancedDataTable.getClassProps","ea",this.getClassProps.bind(this)),ea.hooks.addFilter("advancedDataTable.setClassProps","ea",this.setClassProps.bind(this)),ea.hooks.addFilter("advancedDataTable.parseHTML","ea",this.parseHTML),ea.hooks.addAction("advancedDataTable.initEditor","ea",this.initEditor.bind(this)),ea.hooks.addAction("advancedDataTable.updateFromView","ea",this.updateFromView.bind(this)),ea.hooks.addAction("advancedDataTable.initInlineEdit","ea",this.initInlineEdit.bind(this)),ea.hooks.addAction("advancedDataTable.initPanelAction","ea",this.initPanelAction.bind(this)),elementor.hooks.addFilter("elements/widget/contextMenuGroups",this.initContextMenu),elementor.hooks.addAction("panel/open_editor/widget/eael-advanced-data-table",this.initPanel.bind(this))}var a,n,l;return a=e,(n=[{key:"updateFromView",value:function(e,a){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.model;if(n.remoteRender=t,elementor.config.version>"2.7.6"){var l=e.getContainer(),o=e.getContainer().settings.attributes;Object.keys(a).forEach((function(e){o[e]=a[e]})),parent.window.$e.run("document/elements/settings",{container:l,settings:o,options:{external:t}})}else Object.keys(a).forEach((function(e){n.setSetting(e,a[e])}));this.timeout=setTimeout((function(){n.remoteRender=!0}),1001)}},{key:"getClassProps",value:function(){return{view:this.view,model:this.model,table:this.table,activeCell:this.activeCell}}},{key:"setClassProps",value:function(e){var a=this;Object.keys(e).forEach((function(t){a[t]=e[t]}))}},{key:"parseHTML",value:function(e){return e.querySelectorAll("th, td").forEach((function(e){null!==e.querySelector(".inline-editor")&&(e.innerHTML=decodeURI(e.dataset.quill||""),delete e.dataset.quill)})),e}},{key:"initEditor",value:function(e){var a=this;e.dataset.quill=encodeURI(e.innerHTML),e.innerHTML='<div class="inline-editor">'.concat(e.innerHTML,"</div>");var t=new Quill(e.querySelector(".inline-editor"),{theme:"bubble",modules:{toolbar:["bold","italic","underline","strike","link",{list:"ordered"},{list:"bullet"}]}});t.on("text-change",(function(n,l,o){clearTimeout(a.timeout),e.dataset.quill=encodeURI(t.root.innerHTML);var i=a.parseHTML(a.table.cloneNode(!0));a.updateFromView(a.view,{ea_adv_data_table_static_html:i.innerHTML})}))}},{key:"initInlineEdit",value:function(){var e=this,a=setInterval((function(){e.view.el.querySelector(".ea-advanced-data-table")&&(e.table!==e.view.el.querySelector(".ea-advanced-data-table")&&(e.table=e.view.el.querySelector(".ea-advanced-data-table"),e.table.classList.contains("ea-advanced-data-table-static")&&e.table.querySelectorAll("th, td").forEach((function(a){e.initEditor(a)})),e.table.addEventListener("mousedown",(function(a){a.stopPropagation(),"th"===a.target.tagName.toLowerCase()&&(e.dragging=!0,e.dragEl=a.target,e.dragStartX=a.pageX,e.dragStartWidth=a.target.offsetWidth),"th"===a.target.tagName.toLowerCase()||"td"===a.target.tagName.toLowerCase()?e.activeCell=a.target:"th"===a.target.parentNode.tagName.toLowerCase()||"td"===a.target.parentNode.tagName.toLowerCase()?e.activeCell=a.target.parentNode:"th"===a.target.parentNode.parentNode.tagName.toLowerCase()||"td"===a.target.parentNode.parentNode.tagName.toLowerCase()?e.activeCell=a.target.parentNode.parentNode:"th"!==a.target.parentNode.parentNode.parentNode.tagName.toLowerCase()&&"td"!==a.target.parentNode.parentNode.parentNode.tagName.toLowerCase()||(e.activeCell=a.target.parentNode.parentNode.parentNode)})),e.table.addEventListener("mousemove",(function(a){e.dragging&&(e.dragEl.style.width="".concat(e.dragStartWidth+(event.pageX-e.dragStartX),"px"))})),e.table.addEventListener("mouseup",(function(a){if(e.dragging)if(e.dragging=!1,clearTimeout(e.timeout),e.table.classList.contains("ea-advanced-data-table-static")){var t=e.parseHTML(e.table.cloneNode(!0));e.updateFromView(e.view,{ea_adv_data_table_static_html:t.innerHTML})}else{var n=[];e.table.querySelectorAll("th").forEach((function(e,a){n[a]=e.style.width})),e.updateFromView(e.view,{ea_adv_data_table_dynamic_th_width:n})}})),e.table.addEventListener("dblclick",(function(a){if("th"===a.target.tagName.toLowerCase())if(a.stopPropagation(),clearTimeout(e.timeout),e.table.classList.contains("ea-advanced-data-table-static")){var t=e.parseHTML(e.table.cloneNode(!0));e.updateFromView(e.view,{ea_adv_data_table_static_html:t.innerHTML})}else{var n=[];e.table.querySelectorAll("th").forEach((function(e,a){n[a]=e.style.width})),e.updateFromView(e.view,{ea_adv_data_table_dynamic_th_width:n})}}))),clearInterval(a))}),500)}},{key:"initPanelAction",value:function(){var e=this;this.panel.content.el.onclick=function(a){if("ea:advTable:export"==a.target.dataset.event){for(var t=e.table.querySelectorAll("table tr"),n=[],l=0;l<t.length;l++){var o=[],i=t[l].querySelectorAll("th, td");if(e.table.classList.contains("ea-advanced-data-table-static"))for(var r=0;r<i.length;r++)o.push(JSON.stringify(decodeURI(i[r].dataset.quill)));else for(var d=0;d<i.length;d++)o.push(JSON.stringify(i[d].innerHTML.replace(/(\r\n|\n|\r)/gm," ").trim()));n.push(o.join(","))}var s=new Blob([n.join("\n")],{type:"text/csv"}),c=parent.document.createElement("a");c.classList.add("ea-adv-data-table-download-".concat(e.model.attributes.id)),c.download="ea-adv-data-table-".concat(e.model.attributes.id,".csv"),c.href=window.URL.createObjectURL(s),c.style.display="none",parent.document.body.appendChild(c),c.click(),parent.document.querySelector(".ea-adv-data-table-download-".concat(e.model.attributes.id)).remove()}else if("ea:advTable:import"==a.target.dataset.event){var v=e.panel.content.el.querySelector(".ea_adv_table_csv_string"),u=e.panel.content.el.querySelector(".ea_adv_table_csv_string_table").checked,h=v.value.split("\n"),p="",b="";if(v.value.length>0&&(b+="<tbody>",h.forEach((function(e,a){e.length>0&&(cols=e.match(/("(?:[^"\\]|\\.)*"|[^","]+)/gm),cols.length>0&&(u&&0==a?(p+="<thead><tr>",cols.forEach((function(e){e.match(/(^"")|(^")|("$)|(""$)/g)?p+="<th>".concat(JSON.parse(e),"</th>"):p+="<th>".concat(e,"</th>")})),p+="</tr></thead>"):(b+="<tr>",cols.forEach((function(e){e.match(/(^"")|(^")|("$)|(""$)/g)?b+="<td>".concat(JSON.parse(e),"</td>"):b+="<td>".concat(e,"</td>")})),b+="</tr>")))})),b+="</tbody>",p.length>0||b.length>0)){e.updateFromView(e.view,{ea_adv_data_table_static_html:p+b},!0);var f=setInterval((function(){e.view.el.querySelector(".ea-advanced-data-table").innerHTML==p+b&&(clearInterval(f),ea.hooks.doAction("advancedDataTable.initInlineEdit"))}),500)}v.value=""}ea.hooks.doAction("advancedDataTable.panelAction",e.panel,e.model,e.view,a)}}},{key:"initPanel",value:function(e,a,t){var n=this;this.panel=e,this.model=a,this.view=t,ea.hooks.doAction("advancedDataTable.initInlineEdit"),ea.hooks.doAction("advancedDataTable.initPanelAction"),ea.hooks.doAction("advancedDataTable.afterInitPanel",e,a,t),a.once("editor:close",(function(){var e=n.parseHTML(n.table.cloneNode(!0));n.updateFromView(n.view,{ea_adv_data_table_static_html:e.innerHTML},!0)}))}},{key:"initContextMenu",value:function(e,a){return"eael-advanced-data-table"==a.options.model.attributes.widgetType&&"static"==a.options.model.attributes.settings.attributes.ea_adv_data_table_source&&e.push({name:"ea_advanced_data_table",actions:[{name:"add_row_above",title:"Add Row Above",callback:function(){var e=ea.hooks.applyFilters("advancedDataTable.getClassProps"),a=e.view,t=e.table,n=e.activeCell;if(null!==n&&"th"!=n.tagName.toLowerCase()){for(var l=n.parentNode.rowIndex,o=t.insertRow(l),i=0;i<t.rows[0].cells.length;i++){var r=o.insertCell(i);ea.hooks.doAction("advancedDataTable.initEditor",r)}ea.hooks.applyFilters("advancedDataTable.setClassProps",{activeCell:null});var d=ea.hooks.applyFilters("advancedDataTable.parseHTML",t.cloneNode(!0));ea.hooks.doAction("advancedDataTable.updateFromView",a,{ea_adv_data_table_static_html:d.innerHTML})}}},{name:"add_row_below",title:"Add Row Below",callback:function(){var e=ea.hooks.applyFilters("advancedDataTable.getClassProps"),a=e.view,t=e.table,n=e.activeCell;if(null!==n){for(var l=n.parentNode.rowIndex+1,o=t.insertRow(l),i=0;i<t.rows[0].cells.length;i++){var r=o.insertCell(i);ea.hooks.doAction("advancedDataTable.initEditor",r)}ea.hooks.applyFilters("advancedDataTable.setClassProps",{activeCell:null});var d=ea.hooks.applyFilters("advancedDataTable.parseHTML",t.cloneNode(!0));ea.hooks.doAction("advancedDataTable.updateFromView",a,{ea_adv_data_table_static_html:d.innerHTML})}}},{name:"add_column_left",title:"Add Column Left",callback:function(){var e=ea.hooks.applyFilters("advancedDataTable.getClassProps"),a=e.view,t=e.table,n=e.activeCell;if(null!==n){for(var l=n.cellIndex,o=0;o<t.rows.length;o++)if("th"==t.rows[o].cells[0].tagName.toLowerCase()){var i=t.rows[o].insertBefore(document.createElement("th"),t.rows[o].cells[l]);ea.hooks.doAction("advancedDataTable.initEditor",i)}else{var r=t.rows[o].insertCell(l);ea.hooks.doAction("advancedDataTable.initEditor",r)}ea.hooks.applyFilters("advancedDataTable.setClassProps",{activeCell:null});var d=ea.hooks.applyFilters("advancedDataTable.parseHTML",t.cloneNode(!0));ea.hooks.doAction("advancedDataTable.updateFromView",a,{ea_adv_data_table_static_html:d.innerHTML})}}},{name:"add_column_right",title:"Add Column Right",callback:function(){var e=ea.hooks.applyFilters("advancedDataTable.getClassProps"),a=e.view,t=e.table,n=e.activeCell;if(null!==n){for(var l=n.cellIndex+1,o=0;o<t.rows.length;o++)if("th"==t.rows[o].cells[0].tagName.toLowerCase()){var i=t.rows[o].insertBefore(document.createElement("th"),t.rows[o].cells[l]);ea.hooks.doAction("advancedDataTable.initEditor",i)}else{var r=t.rows[o].insertCell(l);ea.hooks.doAction("advancedDataTable.initEditor",r)}ea.hooks.applyFilters("advancedDataTable.setClassProps",{activeCell:null});var d=ea.hooks.applyFilters("advancedDataTable.parseHTML",t.cloneNode(!0));ea.hooks.doAction("advancedDataTable.updateFromView",a,{ea_adv_data_table_static_html:d.innerHTML})}}},{name:"delete_row",title:"Delete Row",callback:function(){var e=ea.hooks.applyFilters("advancedDataTable.getClassProps"),a=e.view,t=e.table,n=e.activeCell;if(null!==n){var l=n.parentNode.rowIndex;t.deleteRow(l),ea.hooks.applyFilters("advancedDataTable.setClassProps",{activeCell:null});var o=ea.hooks.applyFilters("advancedDataTable.parseHTML",t.cloneNode(!0));ea.hooks.doAction("advancedDataTable.updateFromView",a,{ea_adv_data_table_static_html:o.innerHTML})}}},{name:"delete_column",title:"Delete Column",callback:function(){var e=ea.hooks.applyFilters("advancedDataTable.getClassProps"),a=e.view,t=e.table,n=e.activeCell;if(null!==n){for(var l=n.cellIndex,o=0;o<t.rows.length;o++)t.rows[o].deleteCell(l);ea.hooks.applyFilters("advancedDataTable.setClassProps",{activeCell:null});var i=ea.hooks.applyFilters("advancedDataTable.parseHTML",t.cloneNode(!0));ea.hooks.doAction("advancedDataTable.updateFromView",a,{ea_adv_data_table_static_html:i.innerHTML})}}}]}),e}}])&&t(a.prototype,n),l&&t(a,l),e}();ea.hooks.addAction("editMode.init","ea",(function(){new n}))}});